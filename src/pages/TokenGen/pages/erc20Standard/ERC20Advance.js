import styled from "@emotion/styled";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import FormInput from "./components/FormInput";
import FormTextarea from "./components/FormTextarea";
import ImageInput from "./components/ImageInput";
import RadioInput from "./components/RadioInput";
import ChainSelector from "./components/ChainSelector";
import { media } from "@/shared/styles/media";
import { Button } from "@mui/material";
import Select from '@mui/material/Select';
import MenuItem from '@mui/material/MenuItem';
import SelectedChains from "./components/SelectedChains";
import WalletList from "./components/WalletList";
import WalletVotingPower from "./components/WalletVotingPower";
import CreateDAO from "./components/CreateDAO";
import { useLaunchPadForm } from "../../../launchpad/data/useLaunchPad"
import { useNavigate } from "react-router-dom";
import { LaunchPadFormData, LaunchPadFormSchema, LaunchpadRoutes } from '../../../launchpad/constants'
import React, { Key, useEffect, useState } from "react";
import { Container, Grid } from '@mui/material';
import ERC20Item from './card';
import { FormInputStyle } from "./styles/form";

import Web3, { Bytes } from "web3";
import MyTokenContractABI from "./ABIerc20advance.json";
import axios from "axios"; // Import Axios for making HTTP requests


const infuraRpcUrl =
  "https://mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b";

declare global {
  interface Window {
    ethereum?: any; // Replace 'any' with the appropriate type if known
  }
}






export default function ERC20Advance() {
  const [canisterInfo, setCanisterInfo] = useState('');

 
  
  const [selectedMainnetNetwork, setSelectedMainnetNetwork] =
    useState("MainNet");
  const [selectedTestnetNetwork, setSelectedTestnetNetwork] =
    useState("TestNet");
  const [userAddress, setUserAddress] = useState<string | null>(null);
  const [web3, setWeb3] = useState<Web3 | null>(null); // Declare web3 using useState
  const [chainId, setChainId] = useState<string>(""); // Add state for chainId
  const [selectedRpcUrl, setSelectedRpcUrl] = useState<string>(""); // Declare selectedRpcUrl state
  const [deployedTokens, setDeployedTokens] = useState([]);

  const [name, setName] = useState("");
  const [symbol, setSymbol] = useState("");
  const [decimals, setDecimals] = useState("");
  const [totalSupply, setTotalSupply] = useState("");
  const [selectedNetwork, setSelectedNetwork] = useState("");
  const [contract, setContract] = useState(null);
  const [selectedFunction, setSelectedFunction] = useState(null);
  const [functionInputs, setFunctionInputs] = useState([]);
  const [functionOutputs, setFunctionOutputs] = useState([]);

  

  const convertToAbiItemArray = (abi: any) => {
    if (Array.isArray(abi)) {
      return abi;
    } else if (abi && typeof abi === "object") {
      return [abi];
    }
    return [];
  };
  const abiArray = convertToAbiItemArray(MyTokenContractABI);
  const [selectedToken, setSelectedToken] = useState(null);

  // When the user selects a token from the list
  const handleSelectToken = (token) => {
    setSelectedToken(token);
  };
  const contractAddress = selectedToken ? selectedToken.address : null;

  useEffect(() => {
    if (web3 && abiArray) {
      const newContract = new web3.eth.Contract(abiArray, contractAddress);
      setContract(newContract);
    }
  }, [web3, abiArray, contractAddress]);
 

  const handleSelectFunction = (func: React.SetStateAction<null>) => {
    setSelectedFunction(func);
    const inputs = func.inputs.map((input: { name: any; type: any; }) => ({ name: input.name, type: input.type, value: '' }));
    setFunctionInputs(inputs);
    setFunctionOutputs([]);
  };

  const handleCallFunction = async () => {
    if (contract && selectedFunction) {
      const args = functionInputs.map((input) => input.value);
      try {
        const result = await contract.methods[selectedFunction.name](...args).call();
        const outputs = selectedFunction.outputs.map((output: { name: any; type: any; }, index: string | number) => ({
          name: output.name,
          type: output.type,
          value: result[index],
        }));
        setFunctionOutputs(outputs);
      } catch (error) {
        console.error('Error calling function:', error);
      }
    }
  };
  const networkOptions = {
    mainnet: {
      label: "Mainnet",
      options: [
        {
          label: "Ethereum",
          chainId: "0x1", // Ethereum Mainnet
          rpcUrl:
            "https://mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Linea",
          chainId: "0xe708", // Ethereum Mainnet
          rpcUrl:
            "https://linea-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Polygon",
          chainId: "0x89", // Ethereum Mainnet
          rpcUrl:
            "https://polygon-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Optimism",
          chainId: "0x12c", // Ethereum Mainnet
          rpcUrl:
            "https://optimism-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Arbitrum",
          chainId: "0xa4b1", // Ethereum Mainnet
          rpcUrl:
            "https://arbitrum-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },

        {
          label: "Avalanche",
          chainId: "0xa86a", // Ethereum Mainnet
          rpcUrl:
            "https://avalanche-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Near",
          chainId: "0x4e454152", // Ethereum Mainnet
          rpcUrl:
            "https://near-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Aurora",
          chainId: "0x4e454152", // Ethereum Mainnet
          rpcUrl:
            "https://aurora-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },

        {
          label: "Celo",
          chainId: "0xa4ec", // Ethereum Mainnet
          rpcUrl:
            "https://celo-mainnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
      ],
    },
    testnet: {
      label: "Testnet",
      options: [
        {
          label: "Eth-Goerli",
          chainId: "0x5", // Goerli Testnet

          rpcUrl:
            "https://goerli.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_48x48.png", // Add the path to the Goerli logo

        },
        {
          label: "Arthera-TestNet",
          chainId: "0x2803", // Ethereum Mainnet
          rpcUrl: "https://rpc-test.arthera.net",
          logo: "./IconImage/img_frame371062_22.png", // Add the path to the Goerli logo

        },
        {
          label: "Eth-Sepolia",
          chainId: "0xaa36a7", // Ethereum Mainnet
          rpcUrl:
            "https://sepolia.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_48x48.png", // Add the path to the Goerli logo

        },
        {
          label: "Poly-Mumbai",
          chainId: "0x13881", // Ethereum Mainnet
          rpcUrl:
            "https://polygon-mumbai.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Opt-Goerli",
          chainId: "0x1a4", // Ethereum Mainnet
          rpcUrl:
            "https://optimism-goerli.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_7.png", // Add the path to the Goerli logo

        },
        {
          label: "Arb-Goerli",
          chainId: "0x6f70", // Ethereum Mainnet
          rpcUrl:
            "https://arbitrum-goerli.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_8.png", // Add the path to the Goerli logo

        },
        {
          label: "Avax-Fuji",
          chainId: "0xa869", // Ethereum Mainnet
          rpcUrl:
            "https://avalanche-fuji.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_9.png", // Add the path to the Goerli logo

        },  
        {
          label: "Near-Testnet",
          chainId: "0x4e454153", // Ethereum Mainnet
          rpcUrl:
            "https://near-testnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_28.png", // Add the path to the Goerli logo

        },
        {
          label: "Aurora-Testnet",
          chainId: "0x4e454153", // Ethereum Mainnet
          rpcUrl:
            "https://aurora-testnet.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
        {
          label: "Celo-Alfajores",
          chainId: "0xaef3", // Ethereum Mainnet

          rpcUrl:
            "https://celo-alfajores.infura.io/v3/5f3224c8075b407fa38911977320235b",
            logo: "./IconImage/img_frame371062_1.png", // Add the path to the Goerli logo

        },
      ],
    },
  };

  useEffect(() => {
    const web3Instance = new Web3(selectedRpcUrl);
    setWeb3(web3Instance);

    // Request account access
    if (window.ethereum) {
      window.ethereum
        .enable()
        .then((accounts: string | any[]) => {
          if (accounts.length > 0) {
            const address = accounts[0];
            setUserAddress(address);
            console.log("User Address:", address);
          } else {
            console.error("No accounts found.");
          }
        })
        .catch((error: any) => {
          console.error("Error fetching user address:", error);
        });
    }
  }, [selectedRpcUrl]);

  // Handle mainnet network change
  const handleMainnetNetworkChange = (value: string) => {

    const newSelectedMainnetNetwork = value;
    const newSelectedMainnetRpcUrl = networkOptions.mainnet.options.find(
      (option) => option.label === newSelectedMainnetNetwork
    )?.rpcUrl;
    const newSelectedMainnetCHainId = networkOptions.mainnet.options.find(
      (option) => option.label === newSelectedMainnetNetwork
    )?.chainId;

    setSelectedMainnetNetwork(newSelectedMainnetNetwork);

    if (newSelectedMainnetRpcUrl) {
      setSelectedRpcUrl(newSelectedMainnetRpcUrl);
      console.log("selectedRpcUrl:", newSelectedMainnetRpcUrl);
      console.log("selectedNetwork:", newSelectedMainnetNetwork);

      connectToNetwork(newSelectedMainnetCHainId);
    }
  };

  // Handle testnet network change
  const handleTestnetNetworkChange = (value: string) => {
    const newSelectedTestnetNetwork = value;
    const newSelectedTestnetRpcUrl = networkOptions.testnet.options.find(
      (option) => option.label === newSelectedTestnetNetwork
    )?.rpcUrl;
    setSelectedTestnetNetwork(newSelectedTestnetNetwork);

    const newSelectedTestnetchainID = networkOptions.testnet.options.find(
      (option) => option.label === newSelectedTestnetNetwork
    )?.chainId;

    if (newSelectedTestnetRpcUrl) {
      setSelectedRpcUrl(newSelectedTestnetRpcUrl);
      console.log("selectedRpcUrl:", newSelectedTestnetRpcUrl);
      console.log("selectedNetwork:", newSelectedTestnetNetwork);
      setChainId(newSelectedTestnetNetwork); // Set the chainId based on the selected network

      connectToNetwork(newSelectedTestnetchainID);
    }
  };

  const connectToNetwork = async (chainId: string) => {
    if (window.ethereum) {
      try {
        // Request to switch to the desired network
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId }], // Pass the desired chainId to switch to
        });

        // Network switch was successful
        console.log("Switched to the desired network.");

        // You can add additional logic here to handle the switched network
        // For example, you can update the user interface or perform network-specific tasks.
      } catch (error) {
        // Handle errors, e.g., user rejected the request or the network switch failed
        console.error("Error switching network:", error);
      }
    } else {
      // Ethereum provider not available (e.g., MetaMask not installed)
      console.error("Ethereum provider not available.");
    }
  };
    


  const navigate = useNavigate();
  const [formData, setFormData] = useLaunchPadForm();

  const { control, handleSubmit } = useForm<LaunchPadFormData>({
    defaultValues: formData,
    resolver: zodResolver(LaunchPadFormSchema),
  });

  const onSubmit = (data: LaunchPadFormData) => {
    setFormData(data);
  };
 
  async function deployToken() {

   

    if (!name || !symbol || !totalSupply ) {
      console.error(
        "Please provide valid values for tokenName, tokenSymbol, initialSupply"
      );
      return;
    }


   
  const web3Instance = new Web3(selectedRpcUrl);
  setWeb3(web3Instance);

  if (window.ethereum) {
    const accounts = await window.ethereum.enable();

    window.ethereum
      .enable()
      .then((accounts: string | any[]) => {
        if (accounts.length > 0) {
          const address = accounts[0];
          setUserAddress(address);
          console.log("User Address stage 2:", address);
        } else {
          console.error("No accounts found. (step2)");
        }
      })
      .catch((error: any) => {
        console.error("Error fetching user address:", error);
      });
  }

 
 
  const MyTokenContractData =
    "6101006040527f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c960e0908152503480156200003957600080fd5b506040516200410e3803806200410e83398181016040528101906200005f9190620004de565b818181818160059081620000749190620007c3565b508060069081620000869190620007c3565b5050504660a081815250503073ffffffffffffffffffffffffffffffffffffffff1660c08173ffffffffffffffffffffffffffffffffffffffff1681525050620000d5620000f860201b60201c565b608081815250505050620000ef836200018660201b60201c565b50505062000944565b60007f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f6200012b6200024c60201b60201c565b805190602001207fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc646306040516020016200016b959493929190620008e7565b60405160208183030381529060405280519060200120905090565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8292fce18fa69edf4db7b94ea2e58241df0ae57f97e0a6c9b29067028bf92d7660405160405180910390a35050565b6060600580546200025d90620005b2565b80601f01602080910402602001604051908101604052809291908181526020018280546200028b90620005b2565b8015620002dc5780601f10620002b057610100808354040283529160200191620002dc565b820191906000526020600020905b815481529060010190602001808311620002be57829003601f168201915b5050505050905090565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200032782620002fa565b9050919050565b62000339816200031a565b81146200034557600080fd5b50565b60008151905062000359816200032e565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620003b48262000369565b810181811067ffffffffffffffff82111715620003d657620003d56200037a565b5b80604052505050565b6000620003eb620002e6565b9050620003f98282620003a9565b919050565b600067ffffffffffffffff8211156200041c576200041b6200037a565b5b620004278262000369565b9050602081019050919050565b60005b838110156200045457808201518184015260208101905062000437565b60008484015250505050565b6000620004776200047184620003fe565b620003df565b90508281526020810184848401111562000496576200049562000364565b5b620004a384828562000434565b509392505050565b600082601f830112620004c357620004c26200035f565b5b8151620004d584826020860162000460565b91505092915050565b600080600060608486031215620004fa57620004f9620002f0565b5b60006200050a8682870162000348565b935050602084015167ffffffffffffffff8111156200052e576200052d620002f5565b5b6200053c86828701620004ab565b925050604084015167ffffffffffffffff81111562000560576200055f620002f5565b5b6200056e86828701620004ab565b9150509250925092565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620005cb57607f821691505b602082108103620005e157620005e062000583565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200064b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200060c565b6200065786836200060c565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620006a46200069e62000698846200066f565b62000679565b6200066f565b9050919050565b6000819050919050565b620006c08362000683565b620006d8620006cf82620006ab565b84845462000619565b825550505050565b600090565b620006ef620006e0565b620006fc818484620006b5565b505050565b5b81811015620007245762000718600082620006e5565b60018101905062000702565b5050565b601f82111562000773576200073d81620005e7565b6200074884620005fc565b8101602085101562000758578190505b620007706200076785620005fc565b83018262000701565b50505b505050565b600082821c905092915050565b6000620007986000198460080262000778565b1980831691505092915050565b6000620007b3838362000785565b9150826002028217905092915050565b620007ce8262000578565b67ffffffffffffffff811115620007ea57620007e96200037a565b5b620007f68254620005b2565b6200080382828562000728565b600060209050601f8311600181146200083b576000841562000826578287015190505b620008328582620007a5565b865550620008a2565b601f1984166200084b86620005e7565b60005b8281101562000875578489015182556001820191506020850194506020810190506200084e565b8683101562000895578489015162000891601f89168262000785565b8355505b6001600288020188555050505b505050505050565b6000819050919050565b620008bf81620008aa565b82525050565b620008d0816200066f565b82525050565b620008e1816200031a565b82525050565b600060a082019050620008fe6000830188620008b4565b6200090d6020830187620008b4565b6200091c6040830186620008b4565b6200092b6060830185620008c5565b6200093a6080830184620008d6565b9695505050505050565b60805160a05160c05160e0516137906200097e6000396000610ce5015260006105bf015260006106150152600061063e01526137906000f3fe608060405234801561001057600080fd5b50600436106101425760003560e01c806379cc6790116100b8578063a457c2d71161007c578063a457c2d714610377578063a9059cbb146103a7578063ac9650d8146103d7578063d505accf14610407578063dd62ed3e14610423578063e8a3d4851461045357610142565b806379cc6790146102d35780637ecebe00146102ef5780638da5cb5b1461031f578063938e3d7b1461033d57806395d89b411461035957610142565b8063313ce5671161010a578063313ce567146101ff5780633644e5151461021d578063395093511461023b57806342966c681461026b578063449a52f81461028757806370a08231146102a357610142565b806306fdde0314610147578063095ea7b31461016557806313af40351461019557806318160ddd146101b157806323b872dd146101cf575b600080fd5b61014f610471565b60405161015c9190611f81565b60405180910390f35b61017f600480360381019061017a919061204b565b610503565b60405161018c91906120a6565b60405180910390f35b6101af60048036038101906101aa91906120c1565b610526565b005b6101b9610579565b6040516101c691906120fd565b60405180910390f35b6101e960048036038101906101e49190612118565b610583565b6040516101f691906120a6565b60405180910390f35b6102076105b2565b6040516102149190612187565b60405180910390f35b6102256105bb565b60405161023291906121bb565b60405180910390f35b6102556004803603810190610250919061204b565b610672565b60405161026291906120a6565b60405180910390f35b610285600480360381019061028091906121d6565b61071c565b005b6102a1600480360381019061029c919061204b565b610774565b005b6102bd60048036038101906102b891906120c1565b61080c565b6040516102ca91906120fd565b60405180910390f35b6102ed60048036038101906102e8919061204b565b610855565b005b610309600480360381019061030491906120c1565b610926565b60405161031691906120fd565b60405180910390f35b610327610976565b6040516103349190612212565b60405180910390f35b61035760048036038101906103529190612362565b6109a0565b005b6103616109f3565b60405161036e9190611f81565b60405180910390f35b610391600480360381019061038c919061204b565b610a85565b60405161039e91906120a6565b60405180910390f35b6103c160048036038101906103bc919061204b565b610b6f565b6040516103ce91906120a6565b60405180910390f35b6103f160048036038101906103ec919061240b565b610b92565b6040516103fe919061256f565b60405180910390f35b610421600480360381019061041c91906125e9565b610c9e565b005b61043d6004803603810190610438919061268b565b610de8565b60405161044a91906120fd565b60405180910390f35b61045b610e6f565b6040516104689190611f81565b60405180910390f35b606060058054610480906126fa565b80601f01602080910402602001604051908101604052809291908181526020018280546104ac906126fa565b80156104f95780601f106104ce576101008083540402835291602001916104f9565b820191906000526020600020905b8154815290600101906020018083116104dc57829003601f168201915b5050505050905090565b60008061050e610efd565b905061051b818585610f05565b600191505092915050565b61052e6110ce565b61056d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161056490612777565b60405180910390fd5b6105768161110b565b50565b6000600454905090565b60008061058e610efd565b905061059b8582856111d1565b6105a685858561125d565b60019150509392505050565b60006012905090565b60007f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1614801561063757507f000000000000000000000000000000000000000000000000000000000000000046145b15610664577f0000000000000000000000000000000000000000000000000000000000000000905061066f565b61066c6114df565b90505b90565b60008061067d610efd565b9050610711818585600360008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461070c91906127c6565b610f05565b600191505092915050565b806107263361080c565b1015610767576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161075e90612846565b60405180910390fd5b6107713382611563565b50565b61077c61173b565b6107bb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107b2906128b2565b60405180910390fd5b600081036107fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f59061291e565b60405180910390fd5b6108088282611778565b5050565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b61085d6118d8565b61089c576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108939061298a565b60405180910390fd5b806108a68361080c565b10156108e7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108de90612846565b60405180910390fd5b6000816108f48433610de8565b6108fe91906129aa565b905061090c83336000610f05565b610917833383610f05565b6109218383611563565b505050565b600061096f600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020611915565b9050919050565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6109a8611923565b6109e7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109de90612777565b60405180910390fd5b6109f081611960565b50565b606060068054610a02906126fa565b80601f0160208091040260200160405190810160405280929190818152602001828054610a2e906126fa565b8015610a7b5780601f10610a5057610100808354040283529160200191610a7b565b820191906000526020600020905b815481529060010190602001808311610a5e57829003601f168201915b5050505050905090565b600080610a90610efd565b90506000600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905083811015610b56576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b4d90612a50565b60405180910390fd5b610b638286868403610f05565b60019250505092915050565b600080610b7a610efd565b9050610b8781858561125d565b600191505092915050565b60608282905067ffffffffffffffff811115610bb157610bb0612237565b5b604051908082528060200260200182016040528015610be457816020015b6060815260200190600190039081610bcf5790505b50905060005b83839050811015610c9757610c6630858584818110610c0c57610c0b612a70565b5b9050602002810190610c1e9190612aae565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050611a3b565b828281518110610c7957610c78612a70565b5b60200260200101819052508080610c8f90612b11565b915050610bea565b5092915050565b83421115610ce1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cd890612ba5565b60405180910390fd5b60007f0000000000000000000000000000000000000000000000000000000000000000888888610d108c611a68565b89604051602001610d2696959493929190612bc5565b6040516020818303038152906040528051906020012090506000610d51610d4b6105bb565b83611ac6565b90506000610d6182878787611b07565b90508973ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614610dd1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dc890612c72565b60405180910390fd5b610ddc8a8a8a610f05565b50505050505050505050565b6000600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b60008054610e7c906126fa565b80601f0160208091040260200160405190810160405280929190818152602001828054610ea8906126fa565b8015610ef55780601f10610eca57610100808354040283529160200191610ef5565b820191906000526020600020905b815481529060010190602001808311610ed857829003601f168201915b505050505081565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610f74576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f6b90612d04565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610fe3576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fda90612d96565b60405180910390fd5b80600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040516110c191906120fd565b60405180910390a3505050565b60006110d8610976565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8292fce18fa69edf4db7b94ea2e58241df0ae57f97e0a6c9b29067028bf92d7660405160405180910390a35050565b60006111dd8484610de8565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146112575781811015611249576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161124090612e02565b60405180910390fd5b6112568484848403610f05565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036112cc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112c390612e94565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361133b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161133290612f26565b60405180910390fd5b611346838383611b32565b6000600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050818110156113cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113c490612fb8565b60405180910390fd5b818103600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461146291906127c6565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516114c691906120fd565b60405180910390a36114d9848484611b37565b50505050565b60007f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f61150a610471565b805190602001207fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc64630604051602001611548959493929190612fd8565b60405160208183030381529060405280519060200120905090565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036115d2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016115c99061309d565b60405180910390fd5b6115de82600083611b32565b6000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015611665576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161165c9061312f565b60405180910390fd5b818103600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600460008282546116bd91906129aa565b92505081905550600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161172291906120fd565b60405180910390a361173683600084611b37565b505050565b6000611745610976565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036117e7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016117de9061319b565b60405180910390fd5b6117f360008383611b32565b806004600082825461180591906127c6565b9250508190555080600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461185b91906127c6565b925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516118c091906120fd565b60405180910390a36118d460008383611b37565b5050565b60006118e2610976565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b600081600001549050919050565b600061192d610976565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b600080805461196e906126fa565b80601f016020809104026020016040519081016040528092919081815260200182805461199a906126fa565b80156119e75780601f106119bc576101008083540402835291602001916119e7565b820191906000526020600020905b8154815290600101906020018083116119ca57829003601f168201915b5050505050905081600090816119fd9190613367565b507fc9c7c3fe08b88b4df9d4d47ef47d2c43d55c025a0ba88ca442580ed9e7348a168183604051611a2f929190613439565b60405180910390a15050565b6060611a60838360405180606001604052806027815260200161373460279139611b3c565b905092915050565b600080600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050611ab581611915565b9150611ac081611c09565b50919050565b60006040517f190100000000000000000000000000000000000000000000000000000000000081528360028201528260228201526042812091505092915050565b6000806000611b1887878787611c1f565b91509150611b2581611d01565b8192505050949350505050565b505050565b505050565b6060611b4784611e67565b611b86576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b7d906134e2565b60405180910390fd5b6000808573ffffffffffffffffffffffffffffffffffffffff1685604051611bae919061353e565b600060405180830381855af49150503d8060008114611be9576040519150601f19603f3d011682016040523d82523d6000602084013e611bee565b606091505b5091509150611bfe828286611e8a565b925050509392505050565b6001816000016000828254019250508190555050565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a08360001c1115611c5a576000600391509150611cf8565b600060018787878760405160008152602001604052604051611c7f9493929190613555565b6020604051602081039080840390855afa158015611ca1573d6000803e3d6000fd5b505050602060405103519050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603611cef57600060019250925050611cf8565b80600092509250505b94509492505050565b60006004811115611d1557611d1461359a565b5b816004811115611d2857611d2761359a565b5b0315611e645760016004811115611d4257611d4161359a565b5b816004811115611d5557611d5461359a565b5b03611d95576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611d8c90613615565b60405180910390fd5b60026004811115611da957611da861359a565b5b816004811115611dbc57611dbb61359a565b5b03611dfc576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611df390613681565b60405180910390fd5b60036004811115611e1057611e0f61359a565b5b816004811115611e2357611e2261359a565b5b03611e63576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611e5a90613713565b60405180910390fd5b5b50565b6000808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b60608315611e9a57829050611eea565b600083511115611ead5782518084602001fd5b816040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611ee19190611f81565b60405180910390fd5b9392505050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611f2b578082015181840152602081019050611f10565b60008484015250505050565b6000601f19601f8301169050919050565b6000611f5382611ef1565b611f5d8185611efc565b9350611f6d818560208601611f0d565b611f7681611f37565b840191505092915050565b60006020820190508181036000830152611f9b8184611f48565b905092915050565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611fe282611fb7565b9050919050565b611ff281611fd7565b8114611ffd57600080fd5b50565b60008135905061200f81611fe9565b92915050565b6000819050919050565b61202881612015565b811461203357600080fd5b50565b6000813590506120458161201f565b92915050565b6000806040838503121561206257612061611fad565b5b600061207085828601612000565b925050602061208185828601612036565b9150509250929050565b60008115159050919050565b6120a08161208b565b82525050565b60006020820190506120bb6000830184612097565b92915050565b6000602082840312156120d7576120d6611fad565b5b60006120e584828501612000565b91505092915050565b6120f781612015565b82525050565b600060208201905061211260008301846120ee565b92915050565b60008060006060848603121561213157612130611fad565b5b600061213f86828701612000565b935050602061215086828701612000565b925050604061216186828701612036565b9150509250925092565b600060ff82169050919050565b6121818161216b565b82525050565b600060208201905061219c6000830184612178565b92915050565b6000819050919050565b6121b5816121a2565b82525050565b60006020820190506121d060008301846121ac565b92915050565b6000602082840312156121ec576121eb611fad565b5b60006121fa84828501612036565b91505092915050565b61220c81611fd7565b82525050565b60006020820190506122276000830184612203565b92915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61226f82611f37565b810181811067ffffffffffffffff8211171561228e5761228d612237565b5b80604052505050565b60006122a1611fa3565b90506122ad8282612266565b919050565b600067ffffffffffffffff8211156122cd576122cc612237565b5b6122d682611f37565b9050602081019050919050565b82818337600083830152505050565b6000612305612300846122b2565b612297565b90508281526020810184848401111561232157612320612232565b5b61232c8482856122e3565b509392505050565b600082601f8301126123495761234861222d565b5b81356123598482602086016122f2565b91505092915050565b60006020828403121561237857612377611fad565b5b600082013567ffffffffffffffff81111561239657612395611fb2565b5b6123a284828501612334565b91505092915050565b600080fd5b600080fd5b60008083601f8401126123cb576123ca61222d565b5b8235905067ffffffffffffffff8111156123e8576123e76123ab565b5b602083019150836020820283011115612404576124036123b0565b5b9250929050565b6000806020838503121561242257612421611fad565b5b600083013567ffffffffffffffff8111156124405761243f611fb2565b5b61244c858286016123b5565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b60006124ab82612484565b6124b5818561248f565b93506124c5818560208601611f0d565b6124ce81611f37565b840191505092915050565b60006124e583836124a0565b905092915050565b6000602082019050919050565b600061250582612458565b61250f8185612463565b93508360208202850161252185612474565b8060005b8581101561255d578484038952815161253e85826124d9565b9450612549836124ed565b925060208a01995050600181019050612525565b50829750879550505050505092915050565b6000602082019050818103600083015261258981846124fa565b905092915050565b61259a8161216b565b81146125a557600080fd5b50565b6000813590506125b781612591565b92915050565b6125c6816121a2565b81146125d157600080fd5b50565b6000813590506125e3816125bd565b92915050565b600080600080600080600060e0888a03121561260857612607611fad565b5b60006126168a828b01612000565b97505060206126278a828b01612000565b96505060406126388a828b01612036565b95505060606126498a828b01612036565b945050608061265a8a828b016125a8565b93505060a061266b8a828b016125d4565b92505060c061267c8a828b016125d4565b91505092959891949750929550565b600080604083850312156126a2576126a1611fad565b5b60006126b085828601612000565b92505060206126c185828601612000565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061271257607f821691505b602082108103612725576127246126cb565b5b50919050565b7f4e6f7420617574686f72697a6564000000000000000000000000000000000000600082015250565b6000612761600e83611efc565b915061276c8261272b565b602082019050919050565b6000602082019050818103600083015261279081612754565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006127d182612015565b91506127dc83612015565b92508282019050808211156127f4576127f3612797565b5b92915050565b7f6e6f7420656e6f7567682062616c616e63650000000000000000000000000000600082015250565b6000612830601283611efc565b915061283b826127fa565b602082019050919050565b6000602082019050818103600083015261285f81612823565b9050919050565b7f4e6f7420617574686f72697a656420746f206d696e742e000000000000000000600082015250565b600061289c601783611efc565b91506128a782612866565b602082019050919050565b600060208201905081810360008301526128cb8161288f565b9050919050565b7f4d696e74696e67207a65726f20746f6b656e732e000000000000000000000000600082015250565b6000612908601483611efc565b9150612913826128d2565b602082019050919050565b60006020820190508181036000830152612937816128fb565b9050919050565b7f4e6f7420617574686f72697a656420746f206275726e2e000000000000000000600082015250565b6000612974601783611efc565b915061297f8261293e565b602082019050919050565b600060208201905081810360008301526129a381612967565b9050919050565b60006129b582612015565b91506129c083612015565b92508282039050818111156129d8576129d7612797565b5b92915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b6000612a3a602583611efc565b9150612a45826129de565b604082019050919050565b60006020820190508181036000830152612a6981612a2d565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008083356001602003843603038112612acb57612aca612a9f565b5b80840192508235915067ffffffffffffffff821115612aed57612aec612aa4565b5b602083019250600182023603831315612b0957612b08612aa9565b5b509250929050565b6000612b1c82612015565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203612b4e57612b4d612797565b5b600182019050919050565b7f45524332305065726d69743a206578706972656420646561646c696e65000000600082015250565b6000612b8f601d83611efc565b9150612b9a82612b59565b602082019050919050565b60006020820190508181036000830152612bbe81612b82565b9050919050565b600060c082019050612bda60008301896121ac565b612be76020830188612203565b612bf46040830187612203565b612c0160608301866120ee565b612c0e60808301856120ee565b612c1b60a08301846120ee565b979650505050505050565b7f45524332305065726d69743a20696e76616c6964207369676e61747572650000600082015250565b6000612c5c601e83611efc565b9150612c6782612c26565b602082019050919050565b60006020820190508181036000830152612c8b81612c4f565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000612cee602483611efc565b9150612cf982612c92565b604082019050919050565b60006020820190508181036000830152612d1d81612ce1565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b6000612d80602283611efc565b9150612d8b82612d24565b604082019050919050565b60006020820190508181036000830152612daf81612d73565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000612dec601d83611efc565b9150612df782612db6565b602082019050919050565b60006020820190508181036000830152612e1b81612ddf565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b6000612e7e602583611efc565b9150612e8982612e22565b604082019050919050565b60006020820190508181036000830152612ead81612e71565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b6000612f10602383611efc565b9150612f1b82612eb4565b604082019050919050565b60006020820190508181036000830152612f3f81612f03565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b6000612fa2602683611efc565b9150612fad82612f46565b604082019050919050565b60006020820190508181036000830152612fd181612f95565b9050919050565b600060a082019050612fed60008301886121ac565b612ffa60208301876121ac565b61300760408301866121ac565b61301460608301856120ee565b6130216080830184612203565b9695505050505050565b7f45524332303a206275726e2066726f6d20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b6000613087602183611efc565b91506130928261302b565b604082019050919050565b600060208201905081810360008301526130b68161307a565b9050919050565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b6000613119602283611efc565b9150613124826130bd565b604082019050919050565b600060208201905081810360008301526131488161310c565b9050919050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b6000613185601f83611efc565b91506131908261314f565b602082019050919050565b600060208201905081810360008301526131b481613178565b9050919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830261321d7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826131e0565b61322786836131e0565b95508019841693508086168417925050509392505050565b6000819050919050565b600061326461325f61325a84612015565b61323f565b612015565b9050919050565b6000819050919050565b61327e83613249565b61329261328a8261326b565b8484546131ed565b825550505050565b600090565b6132a761329a565b6132b2818484613275565b505050565b5b818110156132d6576132cb60008261329f565b6001810190506132b8565b5050565b601f82111561331b576132ec816131bb565b6132f5846131d0565b81016020851015613304578190505b613318613310856131d0565b8301826132b7565b50505b505050565b600082821c905092915050565b600061333e60001984600802613320565b1980831691505092915050565b6000613357838361332d565b9150826002028217905092915050565b61337082611ef1565b67ffffffffffffffff81111561338957613388612237565b5b61339382546126fa565b61339e8282856132da565b600060209050601f8311600181146133d157600084156133bf578287015190505b6133c9858261334b565b865550613431565b601f1984166133df866131bb565b60005b82811015613407578489015182556001820191506020850194506020810190506133e2565b868310156134245784890151613420601f89168261332d565b8355505b6001600288020188555050505b505050505050565b600060408201905081810360008301526134538185611f48565b905081810360208301526134678184611f48565b90509392505050565b7f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f60008201527f6e74726163740000000000000000000000000000000000000000000000000000602082015250565b60006134cc602683611efc565b91506134d782613470565b604082019050919050565b600060208201905081810360008301526134fb816134bf565b9050919050565b600081905092915050565b600061351882612484565b6135228185613502565b9350613532818560208601611f0d565b80840191505092915050565b600061354a828461350d565b915081905092915050565b600060808201905061356a60008301876121ac565b6135776020830186612178565b61358460408301856121ac565b61359160608301846121ac565b95945050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f45434453413a20696e76616c6964207369676e61747572650000000000000000600082015250565b60006135ff601883611efc565b915061360a826135c9565b602082019050919050565b6000602082019050818103600083015261362e816135f2565b9050919050565b7f45434453413a20696e76616c6964207369676e6174757265206c656e67746800600082015250565b600061366b601f83611efc565b915061367682613635565b602082019050919050565b6000602082019050818103600083015261369a8161365e565b9050919050565b7f45434453413a20696e76616c6964207369676e6174757265202773272076616c60008201527f7565000000000000000000000000000000000000000000000000000000000000602082015250565b60006136fd602283611efc565b9150613708826136a1565b604082019050919050565b6000602082019050818103600083015261372c816136f0565b905091905056fe416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a264697066735822122073bb9cdbfa7d5791e1a441fce535a827a9789b5621aea8b6ca9b2e44e360e6c664736f6c63430008120033";
  const contractAddress = "0xf8e81D47203A594245E36C48e151709F0C19fBe8"; // Replace with your contract address

  const convertToAbiItemArray = (abi: any) => {
    if (Array.isArray(abi)) {
      return abi;
    } else if (abi && typeof abi === "object") {
      return [abi];
    }
    return [];
  };
  const abiArray = convertToAbiItemArray(MyTokenContractABI);

  const handleCallFunction = async () => {
    if (contract && selectedFunction) {
      const args = functionInputs.map((input) => input.value);
      try {
        const result = await contract.methods[selectedFunction.name](...args).call();
        const outputs = selectedFunction.outputs.map((output, index) => ({
          name: output.name,
          type: output.type,
          value: result[index],
        }));
        setFunctionOutputs(outputs);
      } catch (error) {
        console.error('Error calling function:', error);
      }
    }
  };
  
 
  // Convert nonce to hexadecimal
  const accounts = await window.ethereum.request({
    method: "eth_requestAccounts",
  });
  const userAddress = accounts[0]; // Get the user's address
  const contractArguments: any[] = [
    accounts[0],
  name,
  symbol,
 
];
  console.log("accounts:", accounts);
  console.log("userAddress:", userAddress);

  // Prepare the transaction object
  const contract = new web3.eth.Contract(abiArray);
  console.log("contract:", contract);

  const deployData = contract
    .deploy({
      data: MyTokenContractData,
      arguments: contractArguments,
    })
    .encodeABI();
  console.log("deployData:", deployData);

  const gasPriceWei = await web3.eth.getGasPrice();
  console.log("Estimated gasPriceWei:", gasPriceWei);
  
  const gasPrice = gasPriceWei;
  console.log("Gas Price (Gwei):", gasPrice);
  
  // Remove the fixed gas limit
  // const gasLimit = 1335010;
  
  // Use estimateGas for gas limit calculation
  const gasLimit = await contract
    .deploy({
      data: MyTokenContractData,
      arguments: contractArguments,
    })
    .estimateGas();

  const nonce = await web3.eth.getTransactionCount(userAddress);
  const rawTx = {
    nonce: web3.utils.toHex(nonce),
    gasPrice: web3.utils.toHex(gasPrice),
    gasLimit: web3.utils.toHex(gasLimit),
    data: deployData,
    from: userAddress,
  };
  console.log("rawTx:", rawTx);

  const signedTx = await window.ethereum.request({
    method: "eth_sendTransaction",
    params: [
      {
        from: userAddress,
        to: null, // For contract deployment, set 'to' as null
        gas: rawTx.gasLimit,
        gasPrice: rawTx.gasPrice,
        nonce: rawTx.nonce,
        data: rawTx.data,
      },
    ],
  });

  console.log("Transaction Hash:", signedTx);

  // Send the transaction using MetaMask

  async function waitForReceipt(txHash: Bytes, maxRetries = 60) {
    let retries = 0;
    while (retries < maxRetries) {
      try {
        const receipt = await web3.eth.getTransactionReceipt(txHash);
        if (receipt) {
          return receipt;
        }
        await new Promise((resolve) => setTimeout(resolve, 1000)); // Wait for 1 second before checking again
      } catch (error) {
        console.error("Error while waiting for receipt:", error);
        await new Promise((resolve) => setTimeout(resolve, 1000)); // Wait for 1 second before checking again
      }
      retries++;
    }
    throw new Error("Transaction not mined within the expected time.");
  }

  // After sending the transaction
  const receipt = await waitForReceipt(signedTx, 60); // Wait for a maximum of 60 seconds
  if (receipt && receipt.contractAddress) {
    console.log("Contract deployed at address:", receipt.contractAddress);

    const newToken = {
      name: name,
      symbol: symbol,
      hash: signedTx,
      address: receipt.contractAddress,
      walletAddress: userAddress,
      category: "ERC20Advance",
    };

    // Update the list of deployed tokens


    axios.post('http://localhost:5004/api/saveDeployedTokens', { newToken })
    .then(response => {
      console.log(response.data);
    })
    .catch(error => {
      console.error(error);
    });


    // Retrieve data from the server based on category and walletAddress
const category = 'ERC20Advance'; // Replace with the desired category
const walletAddress = userAddress; // Replace with the user's wallet address

axios.get(`http://localhost:5004/api/getDeployedTokens?category=${category}&walletAddress=${walletAddress}`)
  .then(response => {
    const storedTokens = response.data.deployedTokens;
    console.log(storedTokens);
    setDeployedTokens(response.data.deployedTokens);

  })
  .catch(error => {
    console.error(error);
  });

   

  } else {
    console.log(
      "Transaction mined, but contract address not available yet."
    );
  }




  
  }
 
    
  
 

  return (

    <> 
<div>
      <Title>Mainnet or Testnet:</Title>

      <StyledSelect
      placeholder="Select Network"
        value={selectedNetwork}
        onChange={(e) => setSelectedNetwork(e.target.value)}
        label="Mainnet or Testnet"
      >
        <StyledMenuItem placeholder="Select Netowork" value={null}>Select...</StyledMenuItem>
        <StyledMenuItem value="mainnet">Mainnet</StyledMenuItem>
        <StyledMenuItem value="testnet">Testnet</StyledMenuItem>
      </StyledSelect>
    </div>

    {selectedNetwork === 'mainnet' && (
      <div>
        <Title1>Mainnet:</Title1>
        <StyledSelect
        placeholder=""
          value={selectedMainnetNetwork}
          label="Mainnet"
        >
          {networkOptions.mainnet.options.map((opt) => (
            <StyledMenuItem key={opt.label} placeholder="Mainnet" value={opt.label} onClick={(e) => handleMainnetNetworkChange(opt.label)}
            >
              <img src={opt.logo} alt={`${opt.label} Logo`} style={{ width: '20px', marginRight: '5px' }} />
              {opt.label}
            </StyledMenuItem>
          ))}
        </StyledSelect>
      </div>
    )}

    {selectedNetwork === 'testnet' && (
      <div>
        <Title1>Testnet:</Title1>
        <StyledSelect
          id="testnetSelect"
          value={selectedTestnetNetwork}
          label="Testnet"
        >
          {networkOptions.testnet.options.map((opt) => (
            <StyledMenuItem key={opt.label} value={opt.label}   onClick={(e) => handleTestnetNetworkChange(opt.label)}
            >
              <img src={opt.logo} alt={`${opt.label} Logo`} style={{ width: '20px', marginRight: '5px' }} />
              {opt.label}
            </StyledMenuItem>
          ))}
        </StyledSelect>
      </div>
    )}

    <Form onSubmit={handleSubmit(onSubmit)}>



  
        <Section>
        


          <Title>ERC20 Advance</Title>




          <div>
        <Title1>Token Deployment</Title1>
        <Wrapper>
        <Input type="text" placeholder="Name" value={name} onChange={(e: { target: { value: any; }; }) => setName(e.target.value)} />
        <Input type="text" placeholder="Symbol" value={symbol} onChange={(e: { target: { value: any; }; }) => setSymbol(e.target.value)} />
       <Input type="number" placeholder="Total Supply" value={totalSupply} onChange={(e: { target: { value: any; }; }) => setTotalSupply(e.target.value)} />
        
       
</Wrapper>       
        <Submit onClick={deployToken}>Deploy</Submit>
      </div>
      <div>
      <Title>Deployed Token</Title>
      {deployedTokens
          .filter((token) => token.walletAddress === userAddress) // Filter tokens by wallet address
          .map((token, index) => (
            <div key={index}>
              <p>Name: {token.name}</p>
              <p>Symbol: {token.symbol}</p>
              <p>Hash: {token.hash}</p>
              <p>Contract Address: {token.address}</p>
              <p>Wallet Address: {token.walletAddress}</p>
              <hr />
            </div>
          ))}
    </div>  
 

       
        </Section>

        <div>
      <Title>Select Token:</Title>
      <StyledSelect
      placeholder="Select Token"
        value={selectedToken ? selectedToken.address : ""}
        onChange={(e) => {
          const selected = deployedTokens.find(
            (token) => token.address === e.target.value
          );
          handleSelectToken(selected);
        }}
      >
        <option value="" disabled>
          Select a token
        </option>
        {deployedTokens.map((token) => (
          <option key={token.address} value={token.address}>
            {token.name} - {token.address}
          </option>
        ))}
      </StyledSelect>
    </div>

    {selectedToken && (
      
        <Section>
        <Title1>Functionality</Title1>

        {/* List READ functions */}
        <div>
          <Title>READ Functions</Title>
          {abiArray
            .filter((func) => func.stateMutability === 'view')
            .map((func, index) => (
              <Button key={index} onClick={() => handleSelectFunction(func)}>
                {func.name}
              </Button>
            ))}
        </div>

        {/* List WRITE functions */}
        <div>
          <Title>WRITE Functions</Title>
          {abiArray
            .filter((func) => func.stateMutability === 'nonpayable')
            .map((func, index) => (
              <Button key={index} onClick={() => handleSelectFunction(func)}>
                {func.name}
              </Button>
            ))}
        </div>

        {/* List EVENT functions */}
        <div>
          <Title>EVENT Functions</Title>
          {abiArray
            .filter((func) => func.type === 'event')
            .map((func, index) => (
              <Button key={index} onClick={() => handleSelectFunction(func)}>
                {func.name}
              </Button>
            ))}
        </div>

        {/* Inputs and Call Button */}
        {selectedFunction && (
  <div>
    <Title>Function Inputs</Title>
    {functionInputs.map((input, index) => (
      <div key={index}>
        <input
          type="text"
          placeholder={`${input.name} (${input.type})`}
          value={input.value}
          onChange={(e) => {
            const newInputs = [...functionInputs];
            newInputs[index].value = e.target.value;
            setFunctionInputs(newInputs);
          }}
        />
      </div>
    ))}
    <Button onClick={handleCallFunction}>Call Function</Button>
  </div>
)}

{/* Outputs */}
{functionOutputs.length > 0 && (
  <div>
    <Title>Function Outputs</Title>
    {functionOutputs.map((output, index) => (
      <div key={index}>
        <p>
          {output.name}: {output.value.toString()}
        </p>
      </div>
    ))}
    {/* Add a button or trigger to log the rendered HTML */}
 
  </div>
)}
      </Section>)}
      </Form></>
  );
}

const Wrapper = styled.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
`;



const Input = styled.input`
  ${FormInputStyle}
`;






const Form = styled.form`
  display: flex;
  flex-direction: column;
  border-radius: 8px;
`;
const StyledSelect = styled(Select)`
  
    min-width: 200px;
    margin-right: 30px;
    background: var(--black2);
    color: var(--white);
    font-size: 16px;
    font-weight: 600;
    line-height: 32px;
    letter-spacing: 1px;
    
    border: var(--white);

  

`;

const StyledMenuItem = styled(MenuItem)`
display: flex;
min-width: 200px;
margin-right: 30px;
background: var(--white);
color: var(--black);
border: var(--white);

font-size:  16px;
  font-weight: 600;
  line-height: 32px;
  letter-spacing: 1px;
`;
const Section = styled.section`

  display: flex;
  flex-direction: column;
  gap: 30px;
  padding: 30px 32px;
  background: var(--black2);

  ${media.sm} {
    padding-inline: 10px;
  }
`;

const Title = styled.h1`
  color: var(--white);
  font-size: 20px;
  font-weight: 800;
  line-height: 32px;
  letter-spacing: 1px;
  text-transform: capitalize;
  margin-block-end: 10px;
  gap: 20px;
`;

const Title1 = styled.h3`
  color: var(--blue);
  font-size: 20px;
  font-weight: 600;
  line-height: 32px;
  letter-spacing: 1px;
  text-transform: capitalize;
  margin-block-end: 10px;
`;

const Submit = styled(Button)`
  color: var(--white);
  font-size: 16px;
  font-weight: 600;
  line-height: 25.6px;
  letter-spacing: 0.8px;
  padding: 8px 16px;
  width: max-content;
  border-radius: 4px;
  border: none;
  background: var(--gradient1);
  cursor: pointer;
  margin: 30px 0 0 auto;
`;



